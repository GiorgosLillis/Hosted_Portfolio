import"./global-CSZh90Hh.js";import"./effects-CHs2oLYa.js";let r=null,m=null;function p(){Array.from(f).forEach(t=>{t.classList.remove("dragging"),t.style.boxShadow=""})}function $(e){e.addEventListener("dragstart",t=>{r=e,t.dataTransfer&&typeof t.dataTransfer.effectAllowed<"u"&&t.dataTransfer.setData("text/plain",e.dataset.item||""),p(),setTimeout(()=>{e.classList.add("dragging")},0)}),e.addEventListener("dragover",t=>{t.preventDefault(),t.dataTransfer&&typeof t.dataTransfer.effectAllowed<"u"&&t.dataTransfer.setData("text/plain",e.dataset.item||""),p();const n=t.target.closest("li");if(n&&n!==r){const o=n.getBoundingClientRect(),a=o.y+o.height/2;t.clientY<a?(n.style.boxShadow="inset 0 3px 0 0 var(--bs-effect)",n.style.borderBottom=""):(n.style.boxShadow="inset 0 -3px 0 0 var(--bs-effect)",n.style.borderTop="")}}),e.addEventListener("drop",t=>{t.preventDefault();const n=t.target.closest("li");if(p(),n&&r&&n!==r){const o=n.getBoundingClientRect(),a=o.y+o.height/2;t.clientY<a?d.insertBefore(r,n):d.insertBefore(r,n.nextSibling),E(),r=null}}),e.addEventListener("dragend",()=>{r&&r.classList.remove("dragging"),p(),r=null}),e.addEventListener("touchstart",t=>{t.touches.length===1&&(m&&clearTimeout(m),m=setTimeout(()=>{r=e,e.classList.add("dragging"),t.preventDefault()},400))}),e.addEventListener("touchmove",t=>{if(!r)return;t.preventDefault();const n=t.touches[0],o=n.clientX,a=n.clientY,s=document.elementFromPoint(o,a).closest("li");if(p(),s&&s!==r){const g=s.getBoundingClientRect(),c=g.y+g.height/2;a<c?(s.style.boxShadow="inset 0 3px 0 0 var(--bs-effect)",s.style.borderBottom=""):(s.style.boxShadow="inset 0 -3px 0 0 var(--bs-effect)",s.style.borderTop="")}clearTimeout(m),m=null}),e.addEventListener("touchend",t=>{if(m){clearTimeout(m),m=null;return}if(!r)return;t.preventDefault(),r.classList.remove("dragging"),p();const n=t.changedTouches[0],o=document.elementFromPoint(n.clientX,n.clientY),a=o?o.closest("li"):null;if(a&&r&&a!==r){const i=a.getBoundingClientRect(),s=i.y+i.height/2;n.clientY<s?d.insertBefore(r,a):d.insertBefore(r,a.nextSibling),E()}r=null}),e.addEventListener("touchcancel",()=>{m&&(clearTimeout(m),m=null),r&&r.classList.remove("dragging"),p(),r=null})}function k(){const t=Array.from(f).map(n=>({item:n.dataset.originalItem,quantity:n.dataset.quantity,unit:n.dataset.unit,category:n.dataset.category,check:n.dataset.checked}));localStorage.setItem("myShoppingList",JSON.stringify(t))}function S(){const e=localStorage.getItem("myShoppingList");if(e)try{const t=JSON.parse(e);d.innerHTML="",t.forEach(n=>{let o=document.createElement("li");o.className="list-group-item fs-5 mb-3 rounded-3",o.dataset.item=n.item.toUpperCase(),o.dataset.originalItem=n.item,o.dataset.quantity=n.quantity,o.dataset.unit=n.unit,o.dataset.category=n.category||"Other",o.dataset.checked=n.check,d.appendChild(o)}),E()}catch(t){console.error("Error parsing shopping list from localStorage:",t),localStorage.removeItem("myShoppingList"),d.innerHTML=""}else console.log("No shopping list found in local storage. Starting with an empty list."),d.innerHTML=""}const d=document.getElementById("displayList"),f=d.children,y=document.getElementById("item"),b=document.getElementById("quantity"),I=document.getElementById("unit"),x=document.getElementById("category"),N=document.getElementById("filterCategory"),A=document.getElementById("filterName"),U=document.getElementById("filterAll"),L=document.getElementById("successMessage"),l=document.getElementById("errorMessage"),h=document.getElementById("fileInfo"),D=document.getElementById("submitBtn"),q=document.getElementById("resetBtn"),M=document.getElementById("downloadBtn"),F=document.getElementById("uploadBtn");function O(e,t,n,o){if(o.textContent="",e.length<2)return o.textContent="Write an item.",!1;if(!/[a-zA-Z]/.test(e))return o.textContent="Item has no letters.",!1;if(/(.)\1{3,}/.test(e))return o.textContent="Item has too many repeating characters.",!1;const a=parseFloat(t);return isNaN(a)||a<=0?(o.textContent="Quantity must be a positive number.",!1):n.length<1?(o.textContent="Select a unit.",!1):/[a-zA-Z]/.test(n)?/(.)\1{3,}/.test(n)?(o.textContent="Unit has too many repeating characters.",!1):!0:(o.textContent="Unit has no letters.",!1)}function v(){l.textContent="",h.textContent="",h.className=""}D.addEventListener("click",_);function _(e){e.preventDefault(),v();const t=y.value.trim(),n=b.value.trim(),o=I.value.trim(),a=x.value.trim()||"Other";if(!O(t,n,o,l)){y.focus();return}let i=Array.from(f);const s=t.toUpperCase();if(i.some(u=>u.dataset.item===s)){l.textContent="Item already exists in the list",y.value="",y.focus();return}let c=document.createElement("li");c.className="list-group-item fs-5 mb-3 rounded-3",c.dataset.item=s,c.dataset.originalItem=t,c.dataset.quantity=n,c.dataset.unit=o,c.dataset.category=a,d.append(c),E(),y.value="",b.value="",I.value="",window.innerWidth>=768&&y.focus()}function E(){for(let e=0;e<f.length;e++){const t=f[e],n=t.dataset.originalItem,o=t.dataset.quantity,a=t.dataset.unit,i=t.dataset.category||"Other",s=t.dataset.checked;let g=`${i}: ${n} ${o}${a}`.trim();t.innerHTML=`
      ${e+1}) ${g};
    `,t.draggable="true";const c=H();t.appendChild(c);let u=document.createElement("input");u.type="checkbox",u.id="gotItem"+(e+1),u.className="form-check-input mx-2 float-end",u.checked=s==="true",u.onclick=function(C){return this.parentElement.dataset.checked=this.checked,this.parentElement.ariaLabel=`${e+1}. Category: ${i} Item:${n}, Quantity: ${o}${a}, checkbox: ${this.checked?"checked":"not checked"}`},t.appendChild(u),t.ariaLabel=`${e+1}. Category: ${i} Item:${n}, Quantity: ${o}${a}, checkbox: ${u.checked?"checked":"not checked"}`,$(t)}}function H(){let e=document.createElement("button");return e.innerHTML='<i class="bi bi-trash"></i>',e.className="btn btn-danger btn-sm float-end ms-2",e.onclick=function(){this.parentElement.remove(),v(),E()},e}q.addEventListener("click",w);function w(){v(),d.innerHTML="",document.getElementById("errorMessage").textContent="",document.getElementById("item").value="",document.getElementById("quantity").value="",document.getElementById("unit").value="",document.getElementById("item").focus()}M.addEventListener("click",B);function B(){if(v(),f.length===0){l.textContent="List is empty. Please add items before downloading.";return}let e=document.getElementById("downloadBtn");e.id="confirmDownloadBtn",e.textContent="Confirm Download",e.removeEventListener("click",B),e.addEventListener("click",T)}function T(){let e=Array.from(f);if(v(),f.length===0)l.textContent="List is empty. Please add items before downloading.";else{let n=e.map(s=>{const g=s.dataset.originalItem,c=s.dataset.quantity,u=s.dataset.unit,C=s.dataset.checked==="true"?"Got it!":"";return`${g} ${c}${u} ${C}`.trim()}).filter(s=>s!=="").join(`
`),o=new Blob([n],{type:"text/plain"}),a=URL.createObjectURL(o),i=document.createElement("a");i.href=a,i.download="list.txt",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a)}let t=document.getElementById("confirmDownloadBtn");t.removeEventListener("click",T),t.id="downloadBtn",t.textContent="Download List",t.addEventListener("click",B)}F.addEventListener("click",R);async function R(e){e.preventDefault(),l.textContent="";try{const t=await z({accept:".txt",multiple:!1});t&&t.length>0?await P(t[0]):l.textContent="No file selected"}catch(t){l.textContent=`Error: ${t.message}`}}function z(e){return new Promise((t,n)=>{const o=document.createElement("input");o.type="file",o.accept=e.accept||"",o.multiple=!1,o.onchange=()=>{o.files.length>0?t(Array.from(o.files)):n(new Error("No files selected"))},o.onerror=()=>{n(new Error("Error opening file explorer"))},o.click()})}async function P(e){if(w(),l.textContent="",!e||e.type!=="text/plain"){l.textContent="Please upload a valid text file";return}h.textContent="",h.className="alert alert-info fs-5",h.innerHTML=`<strong>Selected file:</strong> ${e.name}`,h.innerHTML+=`<br><strong>File size:</strong> ${Q(e.size)}`;try{const n=(await Y(e)).split(`
`).filter(o=>o.trim());if(n.length===0){l.textContent="File is empty or contains no valid items";return}n.forEach(o=>{o.trim();const a=document.createElement("li");a.className="list-group-item fs-5 mb-3 rounded-3";const i=o.match(/^([A-Za-z\s]+)\s*(\d+(\.\d+)?)\s*([A-Za-z]+)?\s*(Got it!)?$/i);if(i){const s=i[1].trim(),g=i[2]||"",c=i[4]||"";console.log(i[5]),i[5]?a.dataset.checked="true":a.dataset.checked="false",a.dataset.item=s.toUpperCase(),a.dataset.originalItem=s,a.dataset.quantity=g,a.dataset.unit=c,a.textContent=`${category} ${s} ${g}${c} ${i[6]}`.trim(),console.log(a)}else{l.textContent=`Invalid format in line: "${o}". Expected format: "ITEM QUANTITYUNIT"`;return}d.append(a)}),E(),h.innerHTML=`<strong>Selected file:</strong> ${e.name} (Loaded)`}catch(t){l.textContent=`Error reading file: ${t.message}`}}function Y(e){return new Promise((t,n)=>{const o=new FileReader;o.onload=a=>t(a.target.result),o.onerror=a=>n(a),o.readAsText(e)})}function Q(e){if(e===0)return"0 Bytes";const t=1024,n=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,o)).toFixed(2))+" "+n[o]}N.addEventListener("click",V);function V(){const e=x.value,t=Array.from(f);t.forEach(n=>{n.style.display=""}),e!==""&&(t.forEach(n=>{n.dataset.category===e?n.style.display="":n.style.display="none"}),L.textContent="Items within this category!")}A.addEventListener("click",j);function j(){const e=Array.from(f),t=y.value.trim();L.textContent="",e.forEach(n=>{n.style.display=""}),t!==""&&(e.forEach(n=>{const o=t.toUpperCase();n.dataset.item===o?n.style.display="":n.style.display="none"}),L.textContent="Items with this name!")}U.addEventListener("click",Z);function Z(){const e=Array.from(f),t=x.value,n=y.value.trim();e.forEach(o=>{o.style.display=""}),!(n===""||t==="")&&(e.forEach(o=>{const a=n.toUpperCase(),i=o.dataset.category;o.dataset.item===a&&i===t?o.style.display="":o.style.display="none"}),L.textContent="Items that match all filters!")}document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&k()});window.addEventListener("beforeunload",k);document.addEventListener("DOMContentLoaded",S);
