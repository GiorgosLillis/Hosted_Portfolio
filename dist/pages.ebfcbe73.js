let weather=document.getElementById("weather"),locationEl=document.getElementById("location"),WEATHER_CACHE_KEY="WeatherInfo",LOCATION_CACHE_KEY="LocationInfo",TWENTY_FOUR_HOURS_IN_MILLIS=864e5,HOUR_IN_MILLIS=36e5;async function init(){weather.innerHTML=`
      <span id="loading">Loading weather</span>
    `;try{let e=await getLocation(),o=JSON.parse(localStorage.getItem(WEATHER_CACHE_KEY)),t=new Date().getTime();o&&t-o.timestamp<36e5?(console.log("Weather info is fresh, displaying from localStorage"),displayLocation(e.country,e.countryCode,e.city),displayWeather(o.temperature,o.condition,o.icon)):(console.log("Weather info is older than 1 hour or not found, fetching new data"),await fetchWeather(e.city,e.countryCode))}catch(e){console.error("An error occurred during initialization:",e),weather.innerHTML+=` <br>
            <span class="error">Failed to get location or weather data.</span>
        `}}async function getLocation(){let e=JSON.parse(localStorage.getItem(LOCATION_CACHE_KEY)),o=new Date().getTime();return e&&o-e.timestamp<864e5?(console.log("Location info is fresh, using from localStorage"),e):(console.log("Location info is older than 24 hours or not found, fetching new data"),await callLocationAPI())}async function callLocationAPI(){let e;if(!navigator.geolocation){console.log("Geolocation is not supported by this browser."),weather.innerHTML="Geolocation is not supported by this browser.";return}try{weather.innerHTML='<span id="loading">Getting your location...</span>';let o=await getCurrentPositionPromise(),t=o.coords.latitude,a=o.coords.longitude,n=await fetch(`/api/location?lat=${t}&lon=${a}`),r=await n.json();if(!r||!r.country||!r.city)throw Error("Invalid reverse geocode data.");return e={country:r.country_name,countryCode:r.country,city:r.city,timestamp:new Date().getTime()},localStorage.setItem(LOCATION_CACHE_KEY,JSON.stringify(e)),console.log("Location info saved to local storage"),e}catch(e){switch(e.code){case e.PERMISSION_DENIED:console.error("User denied the request for Geolocation."),weather.innerHTML='<span class="error">Location access denied. Showing weather for a default location.</span>';break;case e.POSITION_UNAVAILABLE:console.error("Location information is unavailable."),weather.innerHTML='<span class="error">Could not find your city. Showing weather for a default location.</span>';break;case e.TIMEOUT:console.error("The request to get user location timed out."),weather.innerHTML='<span class="error">Location request timed out. Showing weather for a default location.</span>';break;default:console.error("An unknown error occurred during location retrieval:",e),weather.innerHTML='<span class="error">An unknown error occurred. Showing weather for a default location.</span>'}}}function getCurrentPositionPromise(){return new Promise((e,o)=>{navigator.geolocation.getCurrentPosition(e,o,{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})})}async function fetchWeather(e,o){try{let t=await fetch(`/api/weather?city=${encodeURIComponent(e)}&country=${encodeURIComponent(o)}`);if(!t.ok)throw Error(`HTTP error! status: ${t.status}`);let a=await t.json(),n=a.main.temp,r=a.weather[0].description,i=`https:${a.weather[0].icon}`,c=JSON.parse(localStorage.getItem(LOCATION_CACHE_KEY));displayLocation(c.country,c.countryCode,c.city),displayWeather(n,r,i);let s={temperature:n,condition:r,icon:i,timestamp:new Date().getTime()};localStorage.setItem(WEATHER_CACHE_KEY,JSON.stringify(s)),console.log("Weather data saved to localStorage")}catch(e){console.error("Error fetching weather:",e),weather.innerHTML='<span class="error">Weather data unavailable for your location.</span>'}}function displayLocation(e,o,t){locationEl.textContent=`Greetings to the visitor from ${t}, ${e}!`}function displayWeather(e,o,t){weather.innerHTML=`
        <img src="${t}" alt="${o}" class="weather-icon">
        <span class="temperature">${e}\xb0C</span>
        <span class="condition">${o}</span>
    `}init();
//# sourceMappingURL=pages.ebfcbe73.js.map
